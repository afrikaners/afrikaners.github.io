<!DOCTYPE html>
<html>
<head>
    <meta name="mobile-web-app-capable" content="yes">
    <script type = "text/javascript"  src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script type = "text/javascript"  src="nosleep.js"></script>
    <style>
        body{
            background-color: black;
            color: white;
            font-size: 5vw;
        }
    </style>
</head>
<body>
<input type="button" id="toggle" value="Wake Lock is disabled" />
<h1>Realtime Generation:</h1>
<h1 id="powerGen">Loading...</h1>
<h3>Total for today:</h3>
<h3 id="powerTotal"></h3>

<script>
    $(document).ready(function(){
       
        load();
        var noSleep = new NoSleep();

        var wakeLockEnabled = false;
        var toggleEl = document.querySelector("#toggle");
        toggleEl.addEventListener('click', function() {
            if (!wakeLockEnabled) {
                noSleep.enable(); // keep the screen on!
                wakeLockEnabled = true;
                toggleEl.value = "Wake Lock is enabled";
                document.getElementById("toggle").style.display = "none";
                //document.body.style.backgroundColor = "green";
            } else {
                noSleep.disable(); // let the screen turn off.
                wakeLockEnabled = false;
                toggleEl.value = "Wake Lock is disabled";
                //document.body.style.backgroundColor = "";
            }
        }, false);

        function load(){
            $.get( "https://valuehold2.apphb.com/api/values", function( data ) {
            // alert( "Data Loaded: " +  );
                var dataString = JSON.stringify(data);
                //console.log(dataString);
                dataString = dataString.replace(/\\n/g, "");
                dataString = dataString.replace(/\\/g, "");
                dataString = dataString.replace(/ /g, '');
                dataString = dataString.substring(1);
                dataString = dataString.substring(0, dataString.length - 1);

                var obj = JSON.parse(dataString);
                var powerGenVal = obj.Body.PAC.Values["1"];
                var integer = parseInt(powerGenVal,10);
                if(integer > 1000){
                    $("#powerGen").text((integer/1000) + ' kW');
                }else{
                    $("#powerGen").text(integer + ' w');
                }

                $("#powerTotal").text(( obj.Body.DAY_ENERGY.Values["1"]/1000) + " kWh");
                setTimeout(function(){load();}, 2000);
            });
        }

    });
</script>
</body>
</html>
